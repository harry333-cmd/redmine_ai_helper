<% if @project&.module_enabled?(:ai_helper) && 
      User.current.allowed_to?(:view_ai_helper, @project) %>

<script>
function initializeIssueTypoChecker() {
  const issueDescTextarea = document.getElementById('issue_description');
  const issueNotesTextarea = document.getElementById('issue_notes');
  
  if (typeof AiHelperTypoChecker !== 'undefined') {
    if (issueDescTextarea) {
      const descTypoChecker = new AiHelperTypoChecker(issueDescTextarea, {
        contextType: 'issue',
        endpoint: '<%= ai_helper_check_issue_typos_path(@project) %>',
        labels: {
          suggestionsTitle: '<%= t('ai_helper.typo_check.suggestions_title') %>',
          noSuggestions: '<%= t('ai_helper.typo_check.no_suggestions') %>',
          checkButton: '<%= t('ai_helper.typo_check.check_button') %>',
          checking: '<%= t('ai_helper.typo_check.checking') %>',
          acceptSuggestion: '<%= t('ai_helper.typo_check.accept_suggestion') %>',
          dismissSuggestion: '<%= t('ai_helper.typo_check.dismiss_suggestion') %>',
          acceptAll: '<%= t('ai_helper.typo_check.accept_all') %>',
          dismissAll: '<%= t('ai_helper.typo_check.dismiss_all') %>',
          errorOccurred: '<%= t('ai_helper.typo_check.error_occurred') %>'
        }
      });
      descTypoChecker.init();
    }
    
    if (issueNotesTextarea) {
      const notesTypoChecker = new AiHelperTypoChecker(issueNotesTextarea, {
        contextType: 'issue',
        endpoint: '<%= ai_helper_check_issue_typos_path(@project) %>',
        labels: {
          suggestionsTitle: '<%= t('ai_helper.typo_check.suggestions_title') %>',
          noSuggestions: '<%= t('ai_helper.typo_check.no_suggestions') %>',
          checkButton: '<%= t('ai_helper.typo_check.check_button') %>',
          checking: '<%= t('ai_helper.typo_check.checking') %>',
          acceptSuggestion: '<%= t('ai_helper.typo_check.accept_suggestion') %>',
          dismissSuggestion: '<%= t('ai_helper.typo_check.dismiss_suggestion') %>',
          acceptAll: '<%= t('ai_helper.typo_check.accept_all') %>',
          dismissAll: '<%= t('ai_helper.typo_check.dismiss_all') %>',
          errorOccurred: '<%= t('ai_helper.typo_check.error_occurred') %>'
        }
      });
      notesTypoChecker.init();
    }
  }
}

document.addEventListener('DOMContentLoaded', initializeIssueTypoChecker);
</script>

<% end %>